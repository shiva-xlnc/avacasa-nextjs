(()=>{var e={};e.id=7308,e.ids=[7308],e.modules={1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,t,r)=>{"use strict";r.d(t,{zR:()=>i});var s=r(38824);let i=globalThis.prisma??new s.PrismaClient},7066:e=>{"use strict";e.exports=require("node:tty")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16698:e=>{"use strict";e.exports=require("node:async_hooks")},18891:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>y,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>d});var i=r(96559),o=r(48088),a=r(37719),n=r(32190),u=r(5069),p=r(45697);let c=p.z.object({q:p.z.string().min(1).max(100),limit:p.z.coerce.number().default(8)}),l=new Map;async function d(e){try{let{searchParams:t}=new URL(e.url),r=c.parse(Object.fromEntries(t)),s=r.q.toLowerCase().trim(),i=`${s}-${r.limit}`,o=l.get(i);if(o&&Date.now()-o.timestamp<3e5)return n.NextResponse.json({success:!0,data:o.data,cached:!0});let a=[];for(let e of((await u.zR.location.findMany({where:{AND:[{active:!0},{OR:[{name:{contains:s}},{slug:{contains:s}}]}]},select:{id:!0,name:!0,slug:!0,propertyCount:!0},take:Math.ceil(r.limit/2),orderBy:[{featured:"desc"},{propertyCount:"desc"}]})).forEach(e=>{a.push({type:"location",id:e.id,title:e.name,subtitle:`${e.propertyCount} properties`,value:e.name,slug:e.slug,icon:"map-pin"})}),[{key:"VILLA",label:"Villas",icon:"home"},{key:"HOLIDAY_HOME",label:"Holiday Homes",icon:"home"},{key:"FARMLAND",label:"Farmlands",icon:"tree"},{key:"PLOT",label:"Plots",icon:"square"},{key:"APARTMENT",label:"Apartments",icon:"building"}].filter(e=>e.label.toLowerCase().includes(s)||e.key.toLowerCase().includes(s)))){let t=await u.zR.property.count({where:{propertyType:e.key,status:"AVAILABLE",active:!0}});t>0&&a.push({type:"property_type",id:e.key,title:e.label,subtitle:`${t} properties`,value:e.label,key:e.key,icon:e.icon})}a.length<r.limit&&(await u.zR.property.findMany({where:{AND:[{active:!0},{status:"AVAILABLE"},{OR:[{title:{contains:s}},{description:{contains:s}}]}]},select:{id:!0,title:!0,slug:!0,propertyType:!0,location:{select:{name:!0}}},take:r.limit-a.length,orderBy:[{featured:"desc"},{views:"desc"}]})).forEach(e=>{a.push({type:"property",id:e.id,title:e.title,subtitle:`${e.propertyType} in ${e.location.name}`,value:e.title,slug:e.slug,icon:"home"})});let p={location:0,property_type:1,property:2},d=a.sort((e,t)=>{let r=e.title.toLowerCase()===s,i=t.title.toLowerCase()===s;if(r&&!i)return -1;if(!r&&i)return 1;let o=e.title.toLowerCase().startsWith(s),a=t.title.toLowerCase().startsWith(s);return o&&!a?-1:!o&&a?1:p[e.type]-p[t.type]}).slice(0,r.limit);if(l.set(i,{data:d,timestamp:Date.now()}),l.size>100){let e=Date.now();for(let[t,r]of l.entries())e-r.timestamp>3e5&&l.delete(t)}return n.NextResponse.json({success:!0,data:d,cached:!1})}catch(e){return console.error("Search suggestions error:",e),n.NextResponse.json({success:!1,error:"Failed to fetch suggestions",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let y=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/search/suggestions/route",pathname:"/api/search/suggestions",filename:"route",bundlePath:"app/api/search/suggestions/route"},resolvedPagePath:"/Users/akashsharma/AkashDocs/avacasa/avacasa-nextjs/src/app/api/search/suggestions/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:h,serverHooks:g}=y;function x(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:h})}},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{"use strict";e.exports=require("node:child_process")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{"use strict";e.exports=require("node:os")},51455:e=>{"use strict";e.exports=require("node:fs/promises")},55511:e=>{"use strict";e.exports=require("crypto")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},78474:e=>{"use strict";e.exports=require("node:events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4243,580,2668,5697,8824],()=>r(18891));module.exports=s})();