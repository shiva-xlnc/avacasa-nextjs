"use strict";(()=>{var e={};e.id=8746,e.ids=[8746],e.modules={1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14985:e=>{e.exports=require("dns")},16698:e=>{e.exports=require("node:async_hooks")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},51455:e=>{e.exports=require("node:fs/promises")},54805:(e,s,t)=>{t.r(s),t.d(s,{patchFetch:()=>f,routeModule:()=>g,serverHooks:()=>q,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>h});var r={};t.r(r),t.d(r,{GET:()=>m,POST:()=>d});var o=t(96559),a=t(48088),i=t(37719),n=t(32190),u=t(5069),l=t(21111),c=t(45697);let p=c.z.object({name:c.z.string().min(2,"Name must be at least 2 characters"),email:c.z.string().optional(),phone:c.z.string().optional(),subject:c.z.string().min(5,"Subject must be at least 5 characters"),message:c.z.string().min(10,"Message must be at least 10 characters"),type:c.z.enum(["GENERAL","SALES","SUPPORT","PARTNERSHIP","PHONE_INQUIRY"]).default("GENERAL"),source:c.z.string().optional().default("web_form"),propertyInterest:c.z.string().optional()});async function d(e){try{console.log("\uD83D\uDCDD Contact API called");let s=await e.json();console.log("\uD83D\uDCDD Request body:",s);let t=p.safeParse(s);if(!t.success)return console.log("❌ Base validation failed:",t.error.errors),n.NextResponse.json({success:!1,error:"Validation failed",details:t.error.errors},{status:400});let r=t.data;if(console.log("✅ Base validation passed:",r),"PHONE_INQUIRY"===r.type){if(!r.phone||r.phone.length<10)return console.log("❌ Phone validation failed for PHONE_INQUIRY"),n.NextResponse.json({success:!1,error:"Phone number is required for phone inquiries",details:[{path:["phone"],message:"Phone number is required for phone inquiries"}]},{status:400});console.log("✅ Phone validation passed for PHONE_INQUIRY")}else{if(!r.email||!c.z.string().email().safeParse(r.email).success)return console.log("❌ Email validation failed for general inquiry"),n.NextResponse.json({success:!1,error:"Valid email is required for general inquiries",details:[{path:["email"],message:"Valid email is required for general inquiries"}]},{status:400});console.log("✅ Email validation passed for general inquiry")}console.log("\uD83D\uDCBE Attempting to save to database...");let o=await u.zR.contactSubmission.create({data:{name:r.name,email:r.email||null,phone:r.phone,subject:r.subject,message:r.message,type:r.type,source:r.source,status:"NEW"}});if(console.log("✅ Saved to database:",o.id),r.email){console.log("\uD83D\uDCE7 Attempting to send email notifications...");try{let e=await (0,l.MT)({name:r.name,email:r.email,phone:r.phone,subject:r.subject,message:r.message,propertyInterest:r.propertyInterest});console.log("\uD83D\uDCE7 Email notifications sent:",e),await u.zR.contactSubmission.update({where:{id:o.id},data:{status:"IN_PROGRESS"}})}catch(e){console.error("❌ Email sending failed:",e)}}else console.log("\uD83D\uDCDE Phone inquiry without email, setting status to IN_PROGRESS"),await u.zR.contactSubmission.update({where:{id:o.id},data:{status:"IN_PROGRESS"}});return console.log("✅ Contact form submission completed successfully"),n.NextResponse.json({success:!0,message:"Thank you for your message! We will get back to you soon.",submissionId:o.id})}catch(e){return console.error("❌ Contact form error:",e),n.NextResponse.json({success:!1,error:"Failed to submit contact form. Please try again."},{status:500})}}async function m(e){try{let{searchParams:s}=new URL(e.url),t=parseInt(s.get("page")||"1"),r=parseInt(s.get("limit")||"10"),o=s.get("status"),a=s.get("type"),i={};o&&(i.status=o),a&&(i.type=a);let[l,c]=await Promise.all([u.zR.contactSubmission.findMany({where:i,orderBy:{createdAt:"desc"},skip:(t-1)*r,take:r}),u.zR.contactSubmission.count({where:i})]);return n.NextResponse.json({success:!0,data:l,pagination:{page:t,limit:r,total:c,pages:Math.ceil(c/r)}})}catch(e){return console.error("Contact submissions fetch error:",e),n.NextResponse.json({success:!1,error:"Failed to fetch contact submissions"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/contact/route",pathname:"/api/contact",filename:"route",bundlePath:"app/api/contact/route"},resolvedPagePath:"/Users/akashsharma/AkashDocs/avacasa/avacasa-nextjs/src/app/api/contact/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:x,workUnitAsyncStorage:h,serverHooks:q}=g;function f(){return(0,i.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:h})}},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},74075:e=>{e.exports=require("zlib")},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4243,580,2668,5697,9526,8824,7555],()=>t(54805));module.exports=r})();