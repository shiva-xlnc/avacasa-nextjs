"use strict";(()=>{var e={};e.id=6747,e.ids=[6747],e.modules={1708:e=>{e.exports=require("node:process")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7066:e=>{e.exports=require("node:tty")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12909:(e,r,t)=>{t.d(r,{K5:()=>d,bS:()=>l,rA:()=>c,rL:()=>p});var s=t(43205),i=t.n(s),n=t(85663),a=t(5069);let o=process.env.JWT_SECRET||"fallback-secret-key";async function l(e,r){try{let t=await a.zR.admin.findUnique({where:{email:e,active:!0}});if(!t||!await n.Ay.compare(r,t.password))return{success:!1,error:"Invalid credentials"};await a.zR.admin.update({where:{id:t.id},data:{lastLogin:new Date}});let s=i().sign({id:t.id,email:t.email,name:t.name,role:t.role},o,{expiresIn:"24h"});return{success:!0,token:s,admin:{id:t.id,email:t.email,name:t.name,role:t.role}}}catch(e){return console.error("Admin authentication error:",e),{success:!1,error:"Authentication failed"}}}function u(e){try{return i().verify(e,o)}catch{return null}}async function c(e){try{let r=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("admin-token")?.value;if(!r)return null;let t=u(r);if(!t||!("role"in t))return null;return await a.zR.admin.findUnique({where:{id:t.id,active:!0}})?t:null}catch{return null}}async function p(e){try{let r=e.headers.get("authorization")?.replace("Bearer ","")||e.cookies.get("user-token")?.value;if(!r)return null;let t=u(r);if(!t||"role"in t)return null;return await a.zR.user.findUnique({where:{id:t.id,active:!0}})?t:null}catch{return null}}async function d(e,r,t,s,i){try{let n=i?.headers.get("x-forwarded-for")||i?.headers.get("x-real-ip")||"unknown",o=i?.headers.get("user-agent")||"unknown",l=i?.headers.get("referer")||null;await a.zR.userActivity.create({data:{userId:e,action:r,resource:t,metadata:s?JSON.stringify(s):null,ipAddress:n,userAgent:o,referrer:l}})}catch(e){console.error("Error tracking user activity:",e)}}},14985:e=>{e.exports=require("dns")},16698:e=>{e.exports=require("node:async_hooks")},21820:e=>{e.exports=require("os")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31421:e=>{e.exports=require("node:child_process")},33873:e=>{e.exports=require("path")},34631:e=>{e.exports=require("tls")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48161:e=>{e.exports=require("node:os")},51455:e=>{e.exports=require("node:fs/promises")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},57975:e=>{e.exports=require("node:util")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{e.exports=require("node:fs")},74075:e=>{e.exports=require("zlib")},76679:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>f,serverHooks:()=>v,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{GET:()=>h,POST:()=>m});var i=t(96559),n=t(48088),a=t(37719),o=t(32190),l=t(12909),u=t(21111),c=t(5069),p=t(45697);let d=p.z.object({recipients:p.z.array(p.z.string().email()).min(1,"At least one recipient is required"),subject:p.z.string().min(1,"Subject is required"),content:p.z.string().min(1,"Content is required"),recipientNames:p.z.record(p.z.string()).optional(),sendToAllUsers:p.z.boolean().default(!1),sendToAllSubscribers:p.z.boolean().default(!1),testMode:p.z.boolean().default(!1)});async function m(e){try{let r=await (0,l.rA)(e);if(!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.json(),s=d.parse(t),i=[...s.recipients],n=s.recipientNames||{};s.sendToAllUsers&&(await c.zR.user.findMany({select:{email:!0,name:!0}})).forEach(e=>{!i.includes(e.email)&&(i.push(e.email),e.name&&(n[e.email]=e.name))}),s.sendToAllSubscribers&&(await c.zR.emailSubscriber.findMany({where:{active:!0},select:{email:!0,name:!0}})).forEach(e=>{!i.includes(e.email)&&(i.push(e.email),e.name&&(n[e.email]=e.name))}),s.testMode&&(i=[r.email],n={[r.email]:r.name||"Admin"}),console.log(`üìß Sending email to ${i.length} recipients...`);let a=await (0,u.$_)({recipients:i,subject:s.subject,content:s.content,recipientNames:n}),p=a.filter(e=>e.result.success).length,m=a.filter(e=>!e.result.success).length;return console.log(`‚úÖ Email campaign completed: ${p} sent, ${m} failed`),o.NextResponse.json({success:!0,message:`Email sent successfully to ${p} recipients`,stats:{total:i.length,successful:p,failed:m,recipients:a.map(e=>({email:e.email,success:e.result.success,error:e.result.error||null}))}})}catch(e){if(console.error("Email sending error:",e),e instanceof p.z.ZodError)return o.NextResponse.json({success:!1,error:"Validation failed",details:e.errors},{status:400});return o.NextResponse.json({success:!1,error:"Failed to send email. Please try again."},{status:500})}}async function h(e){try{if(!await (0,l.rA)(e))return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),t=r.get("action");if("recipients"===t){let[e,r,t]=await Promise.all([c.zR.user.count(),c.zR.emailSubscriber.count({where:{active:!0}}),c.zR.contactSubmission.count()]);return o.NextResponse.json({success:!0,data:{users:e,subscribers:r,contacts:t}})}if("templates"===t){let e=[{id:"welcome",name:"Welcome Message",subject:"Welcome to Avacasa - Your Journey to Dream Properties Begins!",content:`
            <h2>Welcome to the Avacasa Family!</h2>
            <p>We're thrilled to have you join our community of property enthusiasts and investors.</p>
            
            <h3>What's Next?</h3>
            <ul>
              <li>Explore our curated collection of holiday homes and farmlands</li>
              <li>Get personalized property recommendations</li>
              <li>Connect with our expert property consultants</li>
              <li>Stay updated with market insights and investment opportunities</li>
            </ul>
            
            <p>If you have any questions, our team is here to help you every step of the way.</p>
          `},{id:"newsletter",name:"Monthly Newsletter",subject:"Avacasa Monthly Update - New Properties & Market Insights",content:`
            <h2>This Month at Avacasa</h2>
            
            <h3>üè° New Property Listings</h3>
            <p>Discover our latest collection of premium holiday homes and investment properties.</p>
            
            <h3>üìà Market Insights</h3>
            <p>Stay informed with the latest trends in vacation real estate and investment opportunities.</p>
            
            <h3>üí° Investment Tips</h3>
            <p>Expert advice to help you make informed property investment decisions.</p>
            
            <p>Visit our website to explore all new listings and opportunities.</p>
          `},{id:"promotion",name:"Special Offer",subject:"Limited Time Offer - Exclusive Property Deals",content:`
            <h2>üéâ Exclusive Offer Just for You!</h2>
            
            <p>For a limited time, we're offering special deals on select premium properties.</p>
            
            <h3>What's Included:</h3>
            <ul>
              <li>Reduced booking amounts</li>
              <li>Flexible payment plans</li>
              <li>Complimentary legal assistance</li>
              <li>Priority site visits</li>
            </ul>
            
            <p><strong>Offer valid until [DATE]</strong></p>
            
            <p>Contact our team today to learn more about these exclusive opportunities.</p>
          `}];return o.NextResponse.json({success:!0,data:e})}return o.NextResponse.json({success:!1,error:"Invalid action parameter"},{status:400})}catch(e){return console.error("Email templates fetch error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/email/send/route",pathname:"/api/admin/email/send",filename:"route",bundlePath:"app/api/admin/email/send/route"},resolvedPagePath:"/Users/akashsharma/AkashDocs/avacasa/avacasa-nextjs/src/app/api/admin/email/send/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:y,serverHooks:v}=f;function g(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:y})}},76760:e=>{e.exports=require("node:path")},77598:e=>{e.exports=require("node:crypto")},78474:e=>{e.exports=require("node:events")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},91645:e=>{e.exports=require("net")},94735:e=>{e.exports=require("events")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4243,580,2668,3205,5663,5697,9526,8824,7555],()=>t(76679));module.exports=s})();